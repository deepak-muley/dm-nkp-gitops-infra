# Common Patches - Apply to ALL clusters in dev environment
#
# TO UPDATE DURING UPGRADES:
# 1. Update image.name below for all clusters (single value applies to all)
# 2. Update k8s version if needed (add version patch below)
#
# This file contains the patch operations that apply to ALL clusters.
# The target (kind: Cluster) is specified in kustomization.yaml

# Image name patches
- op: replace
  path: /spec/topology/variables/0/value/controlPlane/nutanix/machineDetails/image/name
  value: nkp-rocky-9.6-release-1.34.1-20251225180234
- op: replace
  path: /spec/topology/workers/machineDeployments/0/variables/overrides/0/value/nutanix/machineDetails/image/name
  value: nkp-rocky-9.6-release-1.34.1-20251225180234

# K8s version patch
- op: replace
  path: /spec/topology/version
  value: v1.34.1

# Cluster class patch
- op: replace
  path: /spec/topology/class
  value: nkp-nutanix-v2.17.0

# Cluster Autoscaler configuration
# Set min=1 and max=5 for worker node autoscaling
# NOTE: When using autoscaler, do NOT set a fixed replicas value - autoscaler manages it
- op: replace
  path: /spec/topology/workers/machineDeployments/0/metadata/annotations/cluster.x-k8s.io~1cluster-api-autoscaler-node-group-min-size
  value: "1"
- op: replace
  path: /spec/topology/workers/machineDeployments/0/metadata/annotations/cluster.x-k8s.io~1cluster-api-autoscaler-node-group-max-size
  value: "5"

# NOTE: Secret references are NOT patched here.
# Each cluster in bases/ has its own per-cluster secret names:
#   - dm-nkp-workload-1-pc-credentials, dm-nkp-workload-1-pc-credentials-for-csi, etc.
#   - dm-nkp-workload-2-pc-credentials, dm-nkp-workload-2-pc-credentials-for-csi, etc.
# The corresponding SealedSecrets are in sealed-secrets/ folder.
