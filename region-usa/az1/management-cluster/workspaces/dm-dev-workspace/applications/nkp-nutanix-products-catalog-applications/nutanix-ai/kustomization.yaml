apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  # Namespace for NAI (must be created before SealedSecret)
  - nai-namespace.yaml
  # SealedSecret for NAI image pull credentials (applied to management cluster)
  - nai-image-pull-sealed-secret.yaml
  # ClusterResourceSet to deploy NAI secrets to workload clusters (apply first)
  - nai-workload-cluster-crs.yaml
  # NAI App Deployment
  - nutanix-ai.yaml
  - nutanix-ai-config-overrides.yaml
  # Sealed secret for management cluster (dm-dev-workspace)
  - nutanix-ai-image-pull-sealed-secret.yaml

# Generate ConfigMap for ClusterResourceSet from separate files
configMapGenerator:
  - name: nai-image-pull-secret-resources
    namespace: dm-dev-workspace
    options:
      disableNameSuffixHash: true
      labels:
        app.kubernetes.io/part-of: nutanix-ai
        app.kubernetes.io/component: cluster-resource-set
    files:
      # Namespace YAML for workload clusters
      - namespace.yaml=nai-namespace.yaml
      # SealedSecret YAML for workload clusters
      - sealed-secret.yaml=nai-image-pull-sealed-secret.yaml
