# ClusterResourceSet to deploy NAI Image Pull Secret to all workload clusters
# This should be applied BEFORE enabling the NAI app
#
# NOTE: The ConfigMap is automatically generated by Kustomize configMapGenerator
# from separate files: nai-namespace.yaml and nai-image-pull-sealed-secret.yaml
# The SealedSecret requires all target clusters to have the same sealed-secrets controller private key.
---
apiVersion: addons.cluster.x-k8s.io/v1beta1
kind: ClusterResourceSet
metadata:
  name: nai-image-pull-secret-crs
  namespace: dm-dev-workspace
  labels:
    app.kubernetes.io/part-of: nutanix-ai
    app.kubernetes.io/component: cluster-resource-set
spec:
  # Select all Nutanix-based clusters in this namespace
  clusterSelector:
    matchLabels:
      konvoy.d2iq.io/provider: nutanix
  # Resources to deploy to matching clusters
  resources:
    - kind: ConfigMap
      name: nai-image-pull-secret-resources
  # ApplyOnce means resources are applied once when cluster matches
  strategy: ApplyOnce
